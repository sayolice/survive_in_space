<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì¡´ ê²Œì„ - ë¯¸ì‚¬ì¼ í”¼í•˜ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            border: 3px solid #00ffff;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            background: radial-gradient(circle at center, #1a1a2e, #0a0a1a);
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            color: #00ffff;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        #ui > div {
            margin-bottom: 10px;
        }
        
        #missileInfo {
            margin-top: 15px;
            font-size: 14px;
            color: #ffff00;
        }
        
        #weaponStatus {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 10;
            color: #ffff00;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
            display: none;
        }

        #instructions, #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: #00ffff;
            border: 2px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            max-width: 500px;
        }

        #instructions h1 {
            margin-bottom: 20px;
            color: #ff00ff;
            font-size: 36px;
            text-shadow: 0 0 20px #ff00ff;
        }

        #instructions p {
            margin: 15px 0;
            font-size: 18px;
            line-height: 1.6;
        }

        #instructions .controls-info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 10px;
        }

        #instructions .controls-info strong {
            color: #ffff00;
        }

        #startBtn, #restartBtn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
        }

        #startBtn:hover, #restartBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        #gameOver {
            display: none;
        }

        #gameOver h2 {
            color: #ff0000;
            margin-bottom: 20px;
            font-size: 40px;
            text-shadow: 0 0 20px #ff0000;
        }

        .powerup-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #ffff00;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #ffff00;
            display: none;
        }
        
        #slowMotionGaugeContainer {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="ui">
            <div>ìƒì¡´ ì‹œê°„: <span id="survivalTime">0</span>ì´ˆ</div>
            <div>ìµœê³  ê¸°ë¡: <span id="highScore">0</span>ì´ˆ</div>
            <div>ë¯¸ì‚¬ì¼ ìˆ˜: <span id="missileCount">0</span></div>
            <div id="missileInfo">
                ğŸ”´ ìœ ë„íƒ„: í”Œë ˆì´ì–´ë¥¼ ì¶”ì <br>
                ğŸŸ¢ ì§ì„ íƒ„: ì •ë©´ìœ¼ë¡œ ì§ì§„
            </div>
            <div style="margin-top: 15px;">ğŸƒ ì†ë„: <span id="playerSpeed">5</span></div>
        </div>

        <div class="powerup-indicator" id="powerupIndicator">
            âš¡ ìŠ¬ë¡œìš° ëª¨ì…˜ ë°œë™!
        </div>
        
        <div id="weaponStatus">
            ğŸš€ ë¬´ê¸° íšë“! ìœ ë„íƒ„ ìë™ ê²©ì¶” ì¤‘...
        </div>
        
        <div id="slowMotionGaugeContainer">
            <div style="color: white; font-weight: bold; margin-bottom: 5px;">ìŠ¬ë¡œìš°:</div>
            <div style="width: 300px; height: 15px; background: rgba(0,0,0,0.7); border: 2px solid white; border-radius: 5px; overflow: hidden;">
                <div id="slowMotionGaugeBar" style="height: 100%; width: 0%; background: #00ffff; transition: width 0.1s;"></div>
            </div>
            <div id="slowMotionGaugeText" style="color: yellow; font-weight: bold; margin-top: 3px; font-size: 12px;"></div>
        </div>
        
        <div id="instructions">
            <h1>ğŸ® ìƒì¡´ ê²Œì„</h1>
            <p>ğŸš€ ì‚¬ë°©ì—ì„œ ë‚ ì•„ì˜¤ëŠ” ë¯¸ì‚¬ì¼ì„ í”¼í•˜ì„¸ìš”!</p>
            <p>ğŸ’€ í•œ ë²ˆì´ë¼ë„ ë§ìœ¼ë©´ ê²Œì„ ì˜¤ë²„ì…ë‹ˆë‹¤</p>
            <div class="controls-info">
                <p><strong>ë¯¸ì‚¬ì¼ ì¢…ë¥˜:</strong></p>
                <p>ğŸ”´ <span style="color: #ff6b6b;">ìœ ë„íƒ„</span> - í”Œë ˆì´ì–´ë¥¼ ì¶”ì í•©ë‹ˆë‹¤</p>
                <p>ğŸŸ¢ <span style="color: #51cf66;">ì§ì„ íƒ„</span> - ì •ë©´ìœ¼ë¡œ ì§ì§„í•©ë‹ˆë‹¤</p>
                <p style="margin-top: 15px;"><strong>íŠ¹ìˆ˜ ê¸°ëŠ¥:</strong></p>
                <p>ğŸ”« ë¬´ê¸°ë¥¼ íšë“í•˜ë©´ ë¯¸ì‚¬ì¼ì„ ìë™ ê²©ì¶”í•©ë‹ˆë‹¤!</p>
                <p>ğŸš€ <span style="color: #ff0080;">ìš°ì£¼ì„ </span>ì´ ë‚˜íƒ€ë‚˜ë©´ ì‚¬ë°©ìœ¼ë¡œ ë ˆì´ì €ë¥¼ ë°œì‚¬í•©ë‹ˆë‹¤!</p>
                <p style="color: #ff4444; font-size: 14px;">âš ï¸ ë ˆì´ì €ì— ë‹¿ìœ¼ë©´ ì¦‰ì‹œ ì‚¬ë§í•©ë‹ˆë‹¤!</p>
                <p>ğŸƒ <span style="color: #00ff00;">ì†ë„ ì¦ê°€</span> ì•„ì´í…œì€ ì˜êµ¬íˆ ì´ë™ì†ë„ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤!</p>
                <p style="margin-top: 15px;"><strong>ì¡°ì‘ ë°©ë²•:</strong></p>
                <p>âŒ¨ï¸ WASD ë˜ëŠ” ë°©í–¥í‚¤ë¡œ ì´ë™</p>
                <p>ğŸ–±ï¸ ë§ˆìš°ìŠ¤ë¡œ ì´ë™ (ë§ˆìš°ìŠ¤ ë²„íŠ¼ ê¾¹ ëˆ„ë¥´ê¸°)</p>
                <p>â¸ï¸ <span style="color: #ff00ff;">ìŠ¤í˜ì´ìŠ¤ë°”</span>ë¡œ ìŠ¬ë¡œìš° ëª¨ì…˜ ë°œë™</p>
            </div>
            <button id="startBtn">ê²Œì„ ì‹œì‘</button>
        </div>

        <div id="gameOver">
            <h2>ğŸ’€ ê²Œì„ ì˜¤ë²„</h2>
            <p style="font-size: 24px; color: #ffff00; margin: 20px 0;">
                ìƒì¡´ ì‹œê°„: <span id="finalTime">0</span>ì´ˆ
            </p>
            <button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const survivalTimeElement = document.getElementById('survivalTime');
        const highScoreElement = document.getElementById('highScore');
        const missileCountElement = document.getElementById('missileCount');
        const playerSpeedElement = document.getElementById('playerSpeed');
        const powerupIndicator = document.getElementById('powerupIndicator');
        const slowMotionGaugeBar = document.getElementById('slowMotionGaugeBar');
        const slowMotionGaugeText = document.getElementById('slowMotionGaugeText');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const instructionsDiv = document.getElementById('instructions');
        const gameOverDiv = document.getElementById('gameOver');
        const finalTimeElement = document.getElementById('finalTime');

        // Canvas í¬ê¸° ì„¤ì •
        const gameSize = Math.min(window.innerWidth - 100, window.innerHeight - 200, 800);
        canvas.width = gameSize;
        canvas.height = gameSize;

        // ê²Œì„ ë³€ìˆ˜
        let gameState = 'menu';
        let survivalTime = 0;
        let highScore = localStorage.getItem('survivalHighScore') || 0;
        highScoreElement.textContent = highScore;

        // í”Œë ˆì´ì–´ ì„¤ì •
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 15,
            baseSpeed: 5, // ê¸°ë³¸ ì†ë„
            speed: 5, // í˜„ì¬ ì†ë„
            color: '#00ffff'
        };

        // ë¯¸ì‚¬ì¼ ë°°ì—´
        let missiles = [];
        let missileSpawnTimer = 0;
        let missileSpawnRate = 90; // ë‚œì´ë„ ì¡°ì ˆ
        
        // ë¬´ê¸° ì‹œìŠ¤í…œ
        let weapons = [];
        let weaponSpawnTimer = 0;
        let playerWeapon = null;
        let bullets = [];
        let bulletCooldown = 0;
        
        // ì†ë„ ì¦ê°€ ì•„ì´í…œ ì‹œìŠ¤í…œ
        let speedBoosts = [];
        let speedBoostSpawnTimer = 0;
        let playerSpeedBoostCount = 0;

        // ìš°ì£¼ì„  ì‹œìŠ¤í…œ
        let spaceships = [];
        let spaceshipSpawnTimer = 0;
        let lasers = [];

        // íŒŒí‹°í´ íš¨ê³¼
        let particles = [];

        // ìŠ¬ë¡œìš° ëª¨ì…˜ ì‹œìŠ¤í…œ
        let slowMotion = false;
        let slowMotionTimer = 0;
        let slowMotionGauge = 0; // ê²Œì´ì§€ (0~100)
        let maxSlowMotionGauge = 100;
        let slowMotionGaugeCooldown = 0;

        // ì…ë ¥ ìƒíƒœ
        const keys = {
            w: false,
            a: false,
            s: false,
            d: false,
            ArrowUp: false,
            ArrowDown: false,
            ArrowLeft: false,
            ArrowRight: false,
            ' ': false // ìŠ¤í˜ì´ìŠ¤í‚¤
        };

        let mousePos = { x: canvas.width / 2, y: canvas.height / 2 };

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (keys.hasOwnProperty(key)) keys[key] = true;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = true;
            }
        });

        window.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            if (keys.hasOwnProperty(key)) keys[key] = false;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mousePos = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        });

        let isMouseDown = false;
        let isMouseClick = false;
        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            isMouseClick = true;
        });
        canvas.addEventListener('mouseup', () => isMouseDown = false);

        // ê²Œì„ ì‹œì‘
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', () => {
            gameOverDiv.style.display = 'none';
            resetGame();
            startGame();
        });

        function startGame() {
            gameState = 'playing';
            instructionsDiv.style.display = 'none';
            gameLoop();
        }

        function resetGame() {
            survivalTime = 0;
            missiles = [];
            particles = [];
            missileSpawnTimer = 0;
            missileSpawnRate = 90;
            slowMotion = false;
            slowMotionTimer = 0;
            slowMotionGauge = 0;
            slowMotionGaugeCooldown = 0;
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            player.speed = 5;
            weapons = [];
            weaponSpawnTimer = 0;
            playerWeapon = null;
            bullets = [];
            bulletCooldown = 0;
            speedBoosts = [];
            speedBoostSpawnTimer = 0;
            playerSpeedBoostCount = 0;
            spaceships = [];
            spaceshipSpawnTimer = 0;
            lasers = [];
        }
        
        function createWeapon() {
            const weapon = {
                x: Math.random() * (canvas.width - 100) + 50,
                y: Math.random() * (canvas.height - 100) + 50,
                radius: 20,
                collected: false,
                pulseTimer: 0
            };
            weapons.push(weapon);
        }
        
        function createBullet(fromX, fromY, toX, toY) {
            const dx = toX - fromX;
            const dy = toY - fromY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const bulletSpeed = 10;
            
            const bullet = {
                x: fromX,
                y: fromY,
                radius: 5,
                speed: bulletSpeed,
                velocityX: (dx / distance) * bulletSpeed,
                velocityY: (dy / distance) * bulletSpeed,
                color: '#ffff00'
            };
            bullets.push(bullet);
        }

        function createSpeedBoost() {
            const speedBoost = {
                x: Math.random() * (canvas.width - 100) + 50,
                y: Math.random() * (canvas.height - 100) + 50,
                radius: 15,
                pulseTimer: 0
            };
            speedBoosts.push(speedBoost);
        }

        function createSpaceship() {
            const spaceship = {
                x: Math.random() * (canvas.width - 100) + 50,
                y: Math.random() * (canvas.height - 100) + 50,
                radius: 30,
                duration: 180, // 3ì´ˆ ë™ì•ˆ ìœ ì§€
                fadeTimer: 0
            };
            spaceships.push(spaceship);
            
            // ì‚¬ë°©ìœ¼ë¡œ ë ˆì´ì € ë°œì‚¬
            createLasersFromSpaceship(spaceship.x, spaceship.y, spaceship.x, spaceship.y);
        }
        
        function createLasersFromSpaceship(x, y, centerX, centerY) {
            const laserCount = 8;
            const isClockwise = Math.random() < 0.5; // 50% í™•ë¥ ë¡œ ì‹œê³„/ë°˜ì‹œê³„
            
            for (let i = 0; i < laserCount; i++) {
                const initialAngle = (i / laserCount) * Math.PI * 2;
                const laser = {
                    centerX: x,
                    centerY: y,
                    angle: initialAngle,
                    rotationSpeed: isClockwise ? 0.01 : -0.01, // ì‹œê³„/ë°˜ì‹œê³„ (ëŠë¦° íšŒì „)
                    length: 2000, // ë ˆì´ì € ê¸¸ì´
                    life: 180, // 3ì´ˆ
                    alpha: 1.0,
                    spaceshipX: x,
                    spaceshipY: y,
                    rotationDelay: 60, // 1ì´ˆ ëŒ€ê¸° í›„ íšŒì „ ì‹œì‘
                    warningPhase: 90 // 1.5ì´ˆ ê²½ê³  ë‹¨ê³„
                };
                lasers.push(laser);
            }
        }
        
        function createMissile() {
            const side = Math.floor(Math.random() * 4);
            // íƒ€ì… í™•ë¥ : ìœ ë„íƒ„ 40%, ì§ì„ íƒ„ 40%, ë„íƒ„íƒ„ 20%
            const r = Math.random();
            const type = r < 0.4 ? 'homing' : (r < 0.8 ? 'straight' : 'ricochet');
            
            let missile = {
                x: 0,
                y: 0,
                radius: 10,
                speed: type === 'ricochet' ? 3 + survivalTime / 20 : 2 + survivalTime / 15,
                color: type === 'homing'
                    ? `hsl(${Math.random() * 60 + 180}, 100%, 60%)`
                    : (type === 'ricochet' ? `hsl(${Math.random() * 60 + 300}, 100%, 60%)` : `hsl(${Math.random() * 60}, 100%, 60%)`),
                trail: [],
                type,
                angle: 0,
                velocityX: 0,
                velocityY: 0,
                bounceCount: 0 // ë„íƒ„ íšŸìˆ˜
            };

            // ì‚¬ë°© ì¤‘ ëœë¤í•œ ìœ„ì¹˜ì—ì„œ ìƒì„±
            switch(side) {
                case 0: // ìœ„
                    missile.x = Math.random() * canvas.width;
                    missile.y = -20;
                    if (type === 'straight') missile.angle = Math.PI / 2; // ì•„ë˜ë¡œ ì§ì§„
                    break;
                case 1: // ì˜¤ë¥¸ìª½
                    missile.x = canvas.width + 20;
                    missile.y = Math.random() * canvas.height;
                    if (type === 'straight') missile.angle = Math.PI; // ì™¼ìª½ìœ¼ë¡œ ì§ì§„
                    break;
                case 2: // ì•„ë˜
                    missile.x = Math.random() * canvas.width;
                    missile.y = canvas.height + 20;
                    if (type === 'straight') missile.angle = -Math.PI / 2; // ìœ„ë¡œ ì§ì§„
                    break;
                case 3: // ì™¼ìª½
                    missile.x = -20;
                    missile.y = Math.random() * canvas.height;
                    if (type === 'straight') missile.angle = 0; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì§ì§„
                    break;
            }
            
            // ì§ì„ /ë„íƒ„ ë¯¸ì‚¬ì¼ì˜ ì†ë„ ë²¡í„° ì„¤ì •
            if (missile.type === 'straight') {
                missile.velocityX = Math.cos(missile.angle) * missile.speed;
                missile.velocityY = Math.sin(missile.angle) * missile.speed;
            } else if (missile.type === 'ricochet') {
                // ë„íƒ„íƒ„: ì´ˆê¸° ê°ë„ëŠ” í”Œë ˆì´ì–´ë¥¼ ëŒ€ëµ í–¥í•˜ê±°ë‚˜ ëœë¤
                const aimPlayer = Math.random() < 0.5;
                if (aimPlayer) {
                    const dx = player.x - missile.x;
                    const dy = player.y - missile.y;
                    const ang = Math.atan2(dy, dx);
                    missile.velocityX = Math.cos(ang) * missile.speed;
                    missile.velocityY = Math.sin(ang) * missile.speed;
                    missile.angle = ang;
                } else {
                    const ang = Math.random() * Math.PI * 2;
                    missile.velocityX = Math.cos(ang) * missile.speed;
                    missile.velocityY = Math.sin(ang) * missile.speed;
                    missile.angle = ang;
                }
            }

            missiles.push(missile);
        }

        function createParticle(x, y, color) {
            for (let i = 0; i < 15; i++) {
                particles.push({
                    x: x,
                    y: y,
                    velocityX: (Math.random() - 0.5) * 8,
                    velocityY: (Math.random() - 0.5) * 8,
                    life: 40,
                    size: Math.random() * 6 + 2,
                    color: color || `hsl(${Math.random() * 60}, 100%, 60%)`
                });
            }
        }

        function updatePlayer() {
            let dx = 0, dy = 0;

            // í‚¤ë³´ë“œ ì…ë ¥
            if ((keys.w || keys.ArrowUp) && player.y > 0) dy = -1;
            if ((keys.s || keys.ArrowDown) && player.y < canvas.height) dy = 1;
            if ((keys.a || keys.ArrowLeft) && player.x > 0) dx = -1;
            if ((keys.d || keys.ArrowRight) && player.x < canvas.width) dx = 1;

            // ë§ˆìš°ìŠ¤ ì…ë ¥
            if (isMouseDown) {
                const distX = mousePos.x - player.x;
                const distY = mousePos.y - player.y;
                const distance = Math.sqrt(distX * distX + distY * distY);
                
                if (distance > 5) {
                    dx = distX / distance;
                    dy = distY / distance;
                }
            }

            // ì´ë™
            if (dx !== 0 || dy !== 0) {
                const length = Math.sqrt(dx * dx + dy * dy);
                player.x += (dx / length) * player.speed;
                player.y += (dy / length) * player.speed;
            }

            // ê²½ê³„ ì œí•œ
            player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
            player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
            
            // ìŠ¬ë¡œìš° ëª¨ì…˜ ë°œë™ ì²˜ë¦¬ (ìŠ¤í˜ì´ìŠ¤í‚¤)
            if (keys[' '] && slowMotionGauge >= 100 && !slowMotion && slowMotionGaugeCooldown <= 0) {
                slowMotion = true;
                slowMotionTimer = 0;
                slowMotionGauge = 0;
            }
            
            // ë¬´ê¸° ë°œì‚¬ ì²˜ë¦¬ (í´ë¦­ ë˜ëŠ” ìë™)
            if (playerWeapon && playerWeapon.ammo > 0) {
                playerWeapon.cooldown--;
                
                // ë§ˆìš°ìŠ¤ í´ë¦­ ë˜ëŠ” ìë™ ë°œì‚¬ (ì¿¨ë‹¤ìš´ ì´ˆê³¼ ì‹œ)
                if (playerWeapon.cooldown <= 0) {
                    if (missiles.length > 0) {
                        // ê°€ì¥ ê°€ê¹Œìš´ ë¯¸ì‚¬ì¼ ì°¾ê¸° (ìœ ë„íƒ„ ìš°ì„ )
                        const homingMissiles = missiles.filter(m => m.type === 'homing');
                        let closestMissile = null;
                        let minDist = Infinity;
                        const targetMissiles = homingMissiles.length > 0 ? homingMissiles : missiles;
                        
                        targetMissiles.forEach(missile => {
                            const dist = Math.sqrt(
                                Math.pow(player.x - missile.x, 2) + 
                                Math.pow(player.y - missile.y, 2)
                            );
                            if (dist < minDist) {
                                minDist = dist;
                                closestMissile = missile;
                            }
                        });
                        
                        if (closestMissile && minDist < 300) { // 300í”½ì…€ ì´ë‚´ì—ë§Œ ë°œì‚¬
                            createBullet(player.x, player.y, closestMissile.x, closestMissile.y);
                            playerWeapon.ammo--;
                            playerWeapon.cooldown = 15; // ë°œì‚¬ ê°„ê²©
                            
                            if (playerWeapon.ammo <= 0) {
                                playerWeapon = null;
                            }
                        }
                    }
                }
                
                // í´ë¦­ ë¦¬ì…‹
                isMouseClick = false;
            }
        }

        function reflectVelocity(vx, vy, nx, ny) {
            const dot = vx * nx + vy * ny;
            return { rx: vx - 2 * dot * nx, ry: vy - 2 * dot * ny };
        }

        function updateMissiles() {
            missileSpawnTimer++;
            
            // ì‹œê°„ì— ë”°ë¼ ìŠ¤í° ê°„ê²© ì ì§„ì  ê°ì†Œ
            const baseRate = 90;
            const minRate = 15;
            const difficultyFactor = survivalTime / 10; // 10ì´ˆë§ˆë‹¤ ë‚œì´ë„ ì¦ê°€
            const newSpawnRate = Math.max(minRate, baseRate - difficultyFactor * 8);
            
            missileSpawnRate = newSpawnRate;
            const currentSpawnRate = slowMotion ? missileSpawnRate * 2 : missileSpawnRate;
            
            if (missileSpawnTimer > currentSpawnRate) {
                createMissile();
                missileSpawnTimer = 0;
            }

            for (let i = missiles.length - 1; i >= 0; i--) {
                const missile = missiles[i];
                const speedMultiplier = slowMotion ? 0.3 : 1;
                
                if (missile.type === 'homing') {
                    // ìœ ë„íƒ„: í”Œë ˆì´ì–´ë¥¼ í–¥í•´ ì´ë™
                    const dx = player.x - missile.x;
                    const dy = player.y - missile.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    missile.velocityX = (dx / distance) * missile.speed * speedMultiplier;
                    missile.velocityY = (dy / distance) * missile.speed * speedMultiplier;
                } else if (missile.type === 'straight') {
                    // ì§ì„  ë¯¸ì‚¬ì¼: ì •í•´ì§„ ë°©í–¥ìœ¼ë¡œ ì§ì§„
                    missile.velocityX = Math.cos(missile.angle) * missile.speed * speedMultiplier;
                    missile.velocityY = Math.sin(missile.angle) * missile.speed * speedMultiplier;
                } else if (missile.type === 'ricochet') {
                    // ë„íƒ„ ë¯¸ì‚¬ì¼: í˜„ì¬ ë²¡í„° ìœ ì§€, ì†ë„ í¬ê¸°ë§Œ ìœ ì§€
                    const mag = Math.max(0.0001, Math.hypot(missile.velocityX, missile.velocityY));
                    missile.velocityX = (missile.velocityX / mag) * missile.speed * speedMultiplier;
                    missile.velocityY = (missile.velocityY / mag) * missile.speed * speedMultiplier;
                }
                
                missile.x += missile.velocityX;
                missile.y += missile.velocityY;
                
                // ë¯¸ì‚¬ì¼ ê°ë„ ì—…ë°ì´íŠ¸ (í™”ì‚´í‘œ í‘œì‹œìš©)
                missile.angle = Math.atan2(missile.velocityY, missile.velocityX);

                // ë„íƒ„ ë¯¸ì‚¬ì¼: ë²½ ë°˜ì‚¬ ì²˜ë¦¬
                if (missile.type === 'ricochet') {
                    let bounced = false;
                    if (missile.x <= missile.radius) {
                        const r = reflectVelocity(missile.velocityX, missile.velocityY, 1, 0);
                        missile.velocityX = r.rx; missile.velocityY = r.ry; missile.x = missile.radius;
                        bounced = true;
                    } else if (missile.x >= canvas.width - missile.radius) {
                        const r = reflectVelocity(missile.velocityX, missile.velocityY, -1, 0);
                        missile.velocityX = r.rx; missile.velocityY = r.ry; missile.x = canvas.width - missile.radius;
                        bounced = true;
                    }
                    if (missile.y <= missile.radius) {
                        const r = reflectVelocity(missile.velocityX, missile.velocityY, 0, 1);
                        missile.velocityX = r.rx; missile.velocityY = r.ry; missile.y = missile.radius;
                        bounced = true;
                    } else if (missile.y >= canvas.height - missile.radius) {
                        const r = reflectVelocity(missile.velocityX, missile.velocityY, 0, -1);
                        missile.velocityX = r.rx; missile.velocityY = r.ry; missile.y = canvas.height - missile.radius;
                        bounced = true;
                    }
                    
                    // ë„íƒ„ ì‹œ ì†ë„ ì¦ê°€
                    if (bounced) {
                        missile.bounceCount++;
                        missile.speed += 0.5; // ë„íƒ„í•  ë•Œë§ˆë‹¤ ì†ë„ 0.5 ì¦ê°€
                    }
                }
                
                // ë¯¸ì‚¬ì¼ ê¶¤ì  ì¶”ê°€
                if (missile.trail.length < 25) {
                    missile.trail.push({ x: missile.x, y: missile.y });
            } else {
                    missile.trail.shift();
                    missile.trail.push({ x: missile.x, y: missile.y });
                }
                
                // ì¶©ëŒ ì²´í¬
                const dist = Math.sqrt(
                    Math.pow(player.x - missile.x, 2) + 
                    Math.pow(player.y - missile.y, 2)
                );
                
                if (dist < player.radius + missile.radius) {
                    gameOver();
                    createParticle(player.x, player.y, missile.color);
                    return;
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì‚­ì œ
                if (missile.x < -50 || missile.x > canvas.width + 50 ||
                    missile.y < -50 || missile.y > canvas.height + 50) {
                    missiles.splice(i, 1);
                }
            }

            // ë„íƒ„ ë¯¸ì‚¬ì¼ê³¼ ë‹¤ë¥¸ ë¯¸ì‚¬ì¼ ê°„ ë°˜ì‚¬ ì²˜ë¦¬
            for (let i = 0; i < missiles.length; i++) {
                const m1 = missiles[i];
                if (m1.type !== 'ricochet') continue;
                for (let j = i + 1; j < missiles.length; j++) {
                    const m2 = missiles[j];
                    const dx = m2.x - m1.x;
                    const dy = m2.y - m1.y;
                    const dist = Math.hypot(dx, dy);
                    const minDist = m1.radius + m2.radius;
                    if (dist > 0 && dist < minDist) {
                        const nx = dx / dist;
                        const ny = dy / dist;
                        const r1 = reflectVelocity(m1.velocityX, m1.velocityY, nx, ny);
                        m1.velocityX = r1.rx; m1.velocityY = r1.ry;
                        // ê²¹ì¹¨ í•´ì†Œ
                        const overlap = (minDist - dist) / 2;
                        m1.x -= nx * overlap; m1.y -= ny * overlap;
                        m2.x += nx * overlap; m2.y += ny * overlap;
                        
                        // ë„íƒ„ íƒ„ ì†ë„ ì¦ê°€
                        m1.bounceCount++;
                        m1.speed += 0.5;
                    }
                }
            }

            missileCountElement.textContent = missiles.length;
        }

        function updateWeapons() {
            weaponSpawnTimer++;
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ë¬´ê¸° ìƒì„± (ì•½ 10ì´ˆë§ˆë‹¤)
            if (weaponSpawnTimer > 600 && weapons.length === 0) {
                createWeapon();
                weaponSpawnTimer = 0;
            }
            
            // í”Œë ˆì´ì–´ì™€ ë¬´ê¸° ì¶©ëŒ ì²´í¬
            for (let i = weapons.length - 1; i >= 0; i--) {
                const weapon = weapons[i];
                weapon.pulseTimer += 0.1;
                
                if (!weapon.collected) {
                    const dist = Math.sqrt(
                        Math.pow(player.x - weapon.x, 2) + 
                        Math.pow(player.y - weapon.y, 2)
                    );
                    
                    if (dist < player.radius + weapon.radius) {
                        weapon.collected = true;
                        playerWeapon = {
                            ammo: 10,
                            cooldown: 0
                        };
                        weapons.splice(i, 1);
                        createParticle(weapon.x, weapon.y, '#ffff00');
                        
                        // UI í‘œì‹œ
                        document.getElementById('weaponStatus').style.display = 'block';
                        setTimeout(() => {
                            if (document.getElementById('weaponStatus')) {
                                document.getElementById('weaponStatus').style.display = 'none';
                            }
                        }, 3000);
                    }
                }
            }
        }
        
        function updateSpeedBoosts() {
            speedBoostSpawnTimer++;
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ì†ë„ ì¦ê°€ ì•„ì´í…œ ìƒì„± (ì•½ 20ì´ˆë§ˆë‹¤)
            if (speedBoostSpawnTimer > 1200 && speedBoosts.length === 0) {
                createSpeedBoost();
                speedBoostSpawnTimer = 0;
            }
            
            // í”Œë ˆì´ì–´ì™€ ì†ë„ ì¦ê°€ ì•„ì´í…œ ì¶©ëŒ ì²´í¬
            for (let i = speedBoosts.length - 1; i >= 0; i--) {
                const boost = speedBoosts[i];
                boost.pulseTimer += 0.1;
                
                const dist = Math.sqrt(
                    Math.pow(player.x - boost.x, 2) + 
                    Math.pow(player.y - boost.y, 2)
                );
                
                if (dist < player.radius + boost.radius) {
                    // ì†ë„ ì¦ê°€ (ì˜êµ¬ì )
                    player.speed += 0.5;
                    playerSpeedBoostCount++;
                    createParticle(boost.x, boost.y, '#00ff00');
                    speedBoosts.splice(i, 1);
                    
                    // UI ì—…ë°ì´íŠ¸
                    playerSpeedElement.textContent = player.speed.toFixed(1);
                }
            }
        }
        
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                bullet.x += bullet.velocityX;
                bullet.y += bullet.velocityY;
                
                // ë¯¸ì‚¬ì¼ê³¼ ì¶©ëŒ ì²´í¬
                for (let j = missiles.length - 1; j >= 0; j--) {
                    const missile = missiles[j];
                    const dist = Math.sqrt(
                        Math.pow(bullet.x - missile.x, 2) + 
                        Math.pow(bullet.y - missile.y, 2)
                    );
                    
                    if (dist < bullet.radius + missile.radius) {
                        // ì´ì•Œë¡œ ë¯¸ì‚¬ì¼ íŒŒê´´
                        createParticle(missile.x, missile.y, missile.color);
                        missiles.splice(j, 1);
                        bullets.splice(i, 1);
                        break;
                    }
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì‚­ì œ
                if (bullet.x < -50 || bullet.x > canvas.width + 50 ||
                    bullet.y < -50 || bullet.y > canvas.height + 50) {
                    bullets.splice(i, 1);
                }
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.velocityX;
                p.y += p.velocityY;
                p.life--;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        function updatePowerups() {
            // ìŠ¬ë¡œìš° ëª¨ì…˜ í™œì„±í™” ì¤‘ ì²˜ë¦¬
            if (slowMotion) {
                slowMotionTimer++;
                if (slowMotionTimer > 180) { // 3ì´ˆê°„ ìœ ì§€
                    slowMotion = false;
                    powerupIndicator.style.display = 'none';
                    slowMotionGaugeCooldown = 300; // 5ì´ˆ ì¿¨íƒ€ì„
                }
            }
            
            // ì¿¨íƒ€ì„ ì²˜ë¦¬
            if (slowMotionGaugeCooldown > 0) {
                slowMotionGaugeCooldown--;
            } else {
                // ê²Œì´ì§€ ì„œì„œíˆ ì¶©ì „ (ìŠ¬ë¡œìš° ëª¨ì…˜ ë¹„í™œì„±í™” ì¤‘ì¼ ë•Œë§Œ)
                if (!slowMotion && slowMotionGauge < maxSlowMotionGauge) {
                    slowMotionGauge += 0.2; // ì„œì„œíˆ ì¦ê°€
                    if (slowMotionGauge > maxSlowMotionGauge) {
                        slowMotionGauge = maxSlowMotionGauge;
                    }
                }
            }
        }
        
        function updateSpaceships() {
            spaceshipSpawnTimer++;
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ìš°ì£¼ì„  ìƒì„± (ì•½ 15ì´ˆë§ˆë‹¤)
            if (spaceshipSpawnTimer > 900 && spaceships.length === 0) {
                createSpaceship();
                spaceshipSpawnTimer = 0;
            }
            
            // ìš°ì£¼ì„  ì—…ë°ì´íŠ¸ ë° ì‚­ì œ
            for (let i = spaceships.length - 1; i >= 0; i--) {
                const spaceship = spaceships[i];
                spaceship.duration--;
                spaceship.fadeTimer += 0.05;
                
                if (spaceship.duration <= 0) {
                    spaceships.splice(i, 1);
                }
            }
        }
        
        function updateLasers() {
            for (let i = lasers.length - 1; i >= 0; i--) {
                const laser = lasers[i];
                
                // ê²½ê³  ë‹¨ê³„ ì²˜ë¦¬
                if (laser.warningPhase > 0) {
                    laser.warningPhase--;
                    // ê²½ê³  ë‹¨ê³„ì—ì„œëŠ” ì¶©ëŒ ì²´í¬ ì•ˆ í•¨
                } else {
                    // ì‹¤ì œ ë ˆì´ì € í™œì„±í™” - ì¶©ëŒ ì²´í¬ í•¨
                    checkLaserCollision(laser);
                }
                
                // íšŒì „ ì§€ì—° ì²˜ë¦¬
                if (laser.rotationDelay > 0) {
                    laser.rotationDelay--;
                } else {
                    // ë ˆì´ì € íšŒì „ ì‹œì‘ (ìŠ¬ë¡œìš° ëª¨ì…˜ ì˜í–¥)
                    const speedMultiplier = slowMotion ? 0.3 : 1;
                    laser.angle += laser.rotationSpeed * speedMultiplier;
                }
                
                // ë ˆì´ì € ëì  ê³„ì‚°
                laser.startX = laser.centerX + Math.cos(laser.angle) * 20; // ì‹œì‘ì  ì•½ê°„ ë©€ë¦¬
                laser.startY = laser.centerY + Math.sin(laser.angle) * 20;
                laser.endX = laser.startX + Math.cos(laser.angle) * laser.length;
                laser.endY = laser.startY + Math.sin(laser.angle) * laser.length;
                
                laser.life--;
                
                // ë ˆì´ì € í˜ì´ë“œì•„ì›ƒ
                if (laser.life < 30) {
                    laser.alpha = laser.life / 30;
                }
                
                // ë ˆì´ì € ì‚­ì œ
                if (laser.life <= 0) {
                    lasers.splice(i, 1);
                }
            }
        }
        
        function checkLaserCollision(laser) {
            // í”Œë ˆì´ì–´ ì¶©ëŒ ì²´í¬
            const playerDistance = pointToLineDistance(
                player.x, player.y,
                laser.startX, laser.startY,
                laser.endX, laser.endY
            );
            
            if (playerDistance < player.radius + 5) {
                    gameOver();
                createParticle(player.x, player.y, '#ff0000');
                    return;
            }
            
            // ëª¨ë“  ë¯¸ì‚¬ì¼ê³¼ ì¶©ëŒ ì²´í¬
            for (let i = missiles.length - 1; i >= 0; i--) {
                const missile = missiles[i];
                const distance = pointToLineDistance(
                    missile.x, missile.y,
                    laser.startX, laser.startY,
                    laser.endX, laser.endY
                );
                
                if (distance < missile.radius + 5) {
                    createParticle(missile.x, missile.y, missile.color);
                    missiles.splice(i, 1);
                }
            }
        }
        
        function pointToLineDistance(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;

            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            let param = -1;
            if (lenSq !== 0) param = dot / lenSq;

            let xx, yy;

            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }

            const dx = px - xx;
            const dy = py - yy;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function gameOver() {
            gameState = 'gameover';
            
            if (survivalTime > highScore) {
                highScore = survivalTime;
                localStorage.setItem('survivalHighScore', highScore);
                highScoreElement.textContent = highScore;
            }
            
            finalTimeElement.textContent = Math.floor(survivalTime);
            gameOverDiv.style.display = 'block';
            
            // í­ë°œ íš¨ê³¼
            createParticle(player.x, player.y);
            
            // UI ì†ë„ í‘œì‹œ ì´ˆê¸°í™”
            if (playerSpeedElement) {
                playerSpeedElement.textContent = '5';
            }
        }

        function drawBackground() {
            // ìš°ì£¼ ë°°ê²½
            const gradient = ctx.createRadialGradient(
                canvas.width/2, canvas.height/2, 0,
                canvas.width/2, canvas.height/2, canvas.width/2
            );
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(1, '#0a0a1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ë³„ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 50; i++) {
                const x = (i * 137.5) % canvas.width;
                const y = (i * 237.7) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }
        }

        function drawPlayer() {
            // í”Œë ˆì´ì–´ ê·¸ë¦¼ì
            ctx.save();
            ctx.globalAlpha = 0.3;
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y + 5, player.radius * 1.2, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            // í”Œë ˆì´ì–´ ë³¸ì²´
            const gradient = ctx.createRadialGradient(
                player.x - 5, player.y - 5, 0,
                player.x, player.y, player.radius
            );
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(1, player.color);
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // í”Œë ˆì´ì–´ í…Œë‘ë¦¬
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
            ctx.stroke();
        }

        function drawMissiles() {
            missiles.forEach(missile => {
                // ê¶¤ì  ê·¸ë¦¬ê¸°
                if (missile.trail.length > 1) {
                    ctx.strokeStyle = missile.color;
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.4;
                    ctx.beginPath();
                    ctx.moveTo(missile.trail[0].x, missile.trail[0].y);
                    for (let i = 1; i < missile.trail.length; i++) {
                        ctx.lineTo(missile.trail[i].x, missile.trail[i].y);
                    }
                    ctx.stroke();
                    ctx.globalAlpha = 1;
                }
                
                // ë¯¸ì‚¬ì¼ ë³¸ì²´ ê·¸ë¦¬ê¸° (í™”ì‚´í‘œ ëª¨ì–‘)
            ctx.save();
                ctx.translate(missile.x, missile.y);
                ctx.rotate(missile.angle);
                
                // ë¯¸ì‚¬ì¼ ë³¸ì²´ (ì‚¼ê°í˜•)
                const size = missile.radius;
                const tip = size * 1.5; // ì•ë¶€ë¶„ì´ ë” ê¸´ í™”ì‚´í‘œ
                
                ctx.fillStyle = missile.color;
            ctx.beginPath();
                ctx.moveTo(tip, 0);
                ctx.lineTo(-size * 0.8, -size * 0.8);
                ctx.lineTo(-size * 0.8, size * 0.8);
                ctx.closePath();
            ctx.fill();
            
                // ë¯¸ì‚¬ì¼ ê·¸ë¼ë””ì–¸íŠ¸ íš¨ê³¼
                const gradient = ctx.createLinearGradient(0, 0, tip, 0);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                gradient.addColorStop(1, missile.color);
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.moveTo(tip, 0);
                ctx.lineTo(-size * 0.8, -size * 0.8);
                ctx.lineTo(-size * 0.8, size * 0.8);
                ctx.closePath();
                ctx.fill();
                
                // ë¯¸ì‚¬ì¼ í…Œë‘ë¦¬
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(tip, 0);
                ctx.lineTo(-size * 0.8, -size * 0.8);
                ctx.lineTo(-size * 0.8, size * 0.8);
                ctx.closePath();
                ctx.stroke();
            
            ctx.restore();
            });
        }

        function drawWeapons() {
            weapons.forEach(weapon => {
                if (!weapon.collected) {
                    // ë¬´ê¸° ê·¸ë¼ë””ì–¸íŠ¸
                    const gradient = ctx.createRadialGradient(
                        weapon.x, weapon.y, 0,
                        weapon.x, weapon.y, weapon.radius
                    );
                    gradient.addColorStop(0, '#ffffff');
                    gradient.addColorStop(1, '#ffff00');
                    
            ctx.save();
            
                    // í„ìŠ¤ íš¨ê³¼
                    const pulseRadius = weapon.radius + Math.sin(weapon.pulseTimer) * 5;
                    
                    ctx.fillStyle = gradient;
            ctx.beginPath();
                    ctx.arc(weapon.x, weapon.y, pulseRadius, 0, Math.PI * 2);
            ctx.fill();
            
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(weapon.x, weapon.y, pulseRadius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ë¬´ê¸° ì•„ì´ì½˜ (X ëª¨ì–‘)
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(weapon.x - 8, weapon.y);
                    ctx.lineTo(weapon.x + 8, weapon.y);
                    ctx.moveTo(weapon.x, weapon.y - 8);
                    ctx.lineTo(weapon.x, weapon.y + 8);
                    ctx.stroke();
            
            ctx.restore();
                }
            });
        }
        
        function drawSpeedBoosts() {
            speedBoosts.forEach(boost => {
                // ì†ë„ ì¦ê°€ ì•„ì´í…œ ê·¸ë¼ë””ì–¸íŠ¸
                const gradient = ctx.createRadialGradient(
                    boost.x, boost.y, 0,
                    boost.x, boost.y, boost.radius
                );
                gradient.addColorStop(0, '#ffffff');
                gradient.addColorStop(1, '#00ff00');
                
                ctx.save();
                
                // í„ìŠ¤ íš¨ê³¼
                const pulseRadius = boost.radius + Math.sin(boost.pulseTimer) * 5;
                
                ctx.fillStyle = gradient;
            ctx.beginPath();
                ctx.arc(boost.x, boost.y, pulseRadius, 0, Math.PI * 2);
            ctx.fill();
            
                ctx.strokeStyle = '#00cc00';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(boost.x, boost.y, pulseRadius, 0, Math.PI * 2);
                ctx.stroke();
                
                // ì†ë„ ì•„ì´ì½˜ (â†‘ í™”ì‚´í‘œ)
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.moveTo(boost.x, boost.y - pulseRadius * 0.8);
                ctx.lineTo(boost.x - pulseRadius * 0.5, boost.y);
                ctx.lineTo(boost.x + pulseRadius * 0.5, boost.y);
                ctx.closePath();
                ctx.fill();
            
            ctx.restore();
            });
        }
        
        function drawBullets() {
            bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
            ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
            ctx.fill();
            
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.radius * 0.5, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        function drawSpaceships() {
            spaceships.forEach(spaceship => {
                ctx.save();
                
                // í˜ì´ë“œì•„ì›ƒ íš¨ê³¼
                const alpha = Math.max(0, 1 - spaceship.fadeTimer);
                ctx.globalAlpha = alpha;
                
                // ìš°ì£¼ì„  ê·¸ë¦¬ê¸° (ì‚¼ê°í˜• ëª¨ì–‘)
                const size = spaceship.radius;
                ctx.fillStyle = '#ff0080';
                ctx.beginPath();
                ctx.moveTo(spaceship.x, spaceship.y - size);
                ctx.lineTo(spaceship.x - size * 0.8, spaceship.y + size * 0.6);
                ctx.lineTo(spaceship.x + size * 0.8, spaceship.y + size * 0.6);
                ctx.closePath();
                ctx.fill();
                
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 3;
                ctx.stroke();
            
            ctx.restore();
            });
        }
        
        function drawLasers() {
            lasers.forEach(laser => {
                ctx.save();
                
                // ê²½ê³  ë‹¨ê³„ì¸ì§€ í™•ì¸
                const isWarning = laser.warningPhase > 0;
                ctx.globalAlpha = laser.alpha * (isWarning ? 0.5 : 1); // ê²½ê³  ë‹¨ê³„ëŠ” ë°˜íˆ¬ëª…
                
                // ë ˆì´ì € ê·¸ë¼ë””ì–¸íŠ¸ (ê²½ê³ : ë…¸ë€ìƒ‰, ì‹¤ì œ: ë¹¨ê°„ìƒ‰)
                const gradient = ctx.createLinearGradient(
                    laser.startX, laser.startY,
                    laser.endX, laser.endY
                );
                
                if (isWarning) {
                    // ê²½ê³  ë‹¨ê³„: ë…¸ë€ìƒ‰
                    gradient.addColorStop(0, 'rgba(255, 255, 0, 0)');
                    gradient.addColorStop(0.5, 'rgba(255, 255, 0, 0.6)');
                    gradient.addColorStop(1, 'rgba(255, 255, 0, 0)');
                } else {
                    // ì‹¤ì œ ë ˆì´ì €: ë¹¨ê°„ìƒ‰
                    gradient.addColorStop(0, 'rgba(255, 0, 0, 0)');
                    gradient.addColorStop(0.5, 'rgba(255, 0, 0, 0.8)');
                    gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                }
                
                ctx.strokeStyle = gradient;
                ctx.lineWidth = isWarning ? 5 : 8;
                ctx.beginPath();
                ctx.moveTo(laser.startX, laser.startY);
                ctx.lineTo(laser.endX, laser.endY);
                ctx.stroke();
                
                // ë ˆì´ì € ê¸€ë¡œìš° íš¨ê³¼
                ctx.lineWidth = isWarning ? 15 : 20;
                ctx.globalAlpha = (isWarning ? 0.2 : 0.3) * laser.alpha;
                ctx.stroke();
                
                ctx.restore();
            });
        }
        
        function drawParticles() {
            particles.forEach(p => {
                ctx.save();
                ctx.globalAlpha = p.life / 40;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawBackground();
            drawWeapons();
            drawSpeedBoosts();
            drawBullets();
            drawSpaceships();
            drawLasers();
            drawMissiles();
            drawParticles();
            drawPlayer();
            
            // ë¬´ê¸° ìƒíƒœ í‘œì‹œ
            if (playerWeapon) {
                ctx.save();
                ctx.fillStyle = '#ffff00';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`íƒ„ì•½: ${playerWeapon.ammo}`, canvas.width / 2, canvas.height - 20);
                ctx.restore();
            }
            
            // ìŠ¬ë¡œìš° ëª¨ì…˜ ê²Œì´ì§€ ì—…ë°ì´íŠ¸ (HTMLë¡œ í‘œì‹œ)
            const gaugePercent = slowMotionGauge / maxSlowMotionGauge;
            slowMotionGaugeBar.style.width = `${gaugePercent * 100}%`;
            
            if (gaugePercent >= 1) {
                slowMotionGaugeBar.style.background = '#ff00ff';
            } else {
                slowMotionGaugeBar.style.background = '#00ffff';
            }
            
            if (gaugePercent >= 1 && !slowMotion && slowMotionGaugeCooldown <= 0) {
                slowMotionGaugeText.textContent = '[ìŠ¤í˜ì´ìŠ¤ë°”]';
            } else {
                slowMotionGaugeText.textContent = '';
            }
        }

        function update() {
            if (gameState !== 'playing') return;
            
            updatePlayer();
            updateMissiles();
            updateWeapons();
            updateSpeedBoosts();
            updateBullets();
            updateSpaceships();
            updateLasers();
            updateParticles();
            updatePowerups();
            
            survivalTime += 0.016; // 60fps ê¸°ì¤€
            survivalTimeElement.textContent = Math.floor(survivalTime);
        }

        function gameLoop() {
            update();
            draw();
            
            if (gameState === 'playing') {
                requestAnimationFrame(gameLoop);
            }
        }

        // ì°½ í¬ê¸° ì¡°ì •
        window.addEventListener('resize', () => {
            const newSize = Math.min(window.innerWidth - 100, window.innerHeight - 200, 800);
            canvas.width = newSize;
            canvas.height = newSize;
            
            if (gameState === 'menu') {
                player.x = canvas.width / 2;
                player.y = canvas.height / 2;
            }
        });
    </script>
</body>
</html>